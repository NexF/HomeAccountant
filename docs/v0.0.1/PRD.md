# 家庭记账 - 产品需求文档 (PRD)

> **版本：v0.0.1 (MVP)**
> **归档日期：2026-02-13**
> **状态：已完成**
> **说明：此文档为 MVP v0.0.1 版本归档，后续版本升级请参见对应版本目录下的新文档。**

## 1. 产品概述

### 1.1 产品名称
**家庭记账** (Home Accountant)

### 1.2 产品定位
一款基于**会计复式记账法**的家庭财务管理工具，以**资产负债表**为核心视角，帮助家庭从"记流水账"升级为"管理家庭财务报表"。区别于传统记账 App 只关注收支流水，本产品关注的是：**你的家庭净资产是多少？它是如何变化的？**

### 1.3 核心会计模型
遵循会计恒等式：

> **资产 = 负债 + 净资产（所有者权益）**

每笔经济活动都以**复式记账**（借贷双方）记录，确保等式始终平衡。

**核心概念映射：**
| 会计概念 | 家庭场景含义 | 举例 |
|---------|-------------|------|
| 资产 | 家庭拥有的一切有价值的东西 | 现金、银行存款、股票、基金、房产、汽车、电脑、手机 |
| 负债 | 家庭欠别人的钱 | 房贷、车贷、信用卡待还、花呗、借款 |
| 净资产 | 资产 - 负债，真实家庭财富 | — |
| 收入 | 增加净资产的来源 | 工资、奖金、理财收益、租金收入 |
| 费用 | 消耗掉的支出（减少净资产） | 餐饮、交通、水电、娱乐 |
| 资产支出 | 用一种资产换另一种资产（不影响净资产） | 用现金买手机、用存款买股票 |

### 1.4 目标用户
- 希望从"财务全貌"角度管理家庭财富的用户
- 有一定财务意识，关注净资产增长的家庭
- 想要理解"钱花到哪了"以及"我现在有多少钱"的人

### 1.5 核心价值
- **资产负债全景**：一目了然看到家庭总资产、总负债、净资产
- **区分费用与资产**：花 8000 买手机是资产转换（现金→手机），不是"花掉了"
- **净资产趋势**：追踪真正的财富变化，而非简单的收支差
- **复式平衡**：每笔记录自动平衡，数据天然准确
- **资产折旧**：支持对固定资产设置折旧，反映真实价值
- **外部账户同步**：对接银行、券商等外部数据源，自动获取余额和交易流水
- **智能对账**：将外部账户的真实变动与手工记录自动比对，差异部分自动生成调节分录

---

## 2. 核心概念与记账逻辑

### 2.1 科目体系（Chart of Accounts）

采用简化的会计科目体系，分为五大类：

#### 一、资产类科目
| 科目代码 | 科目名称 | 子科目示例 | 借增贷减 |
|---------|---------|-----------|---------|
| 1001 | 现金 | — | 借+ 贷- |
| 1002 | 银行存款 | 工商银行、招商银行 | 借+ 贷- |
| 1003 | 第三方支付 | 支付宝、微信钱包 | 借+ 贷- |
| 1101 | 应收款项 | 别人欠我的钱 | 借+ 贷- |
| 1201 | 短期投资 | 股票、基金、理财产品、加密货币 | 借+ 贷- |
| 1301 | 预付款项 | 预付房租、充值卡、年费会员 | 借+ 贷- |
| 1501 | 固定资产 | 房产、汽车、电脑、手机、家电 | 借+ 贷- |
| 1502 | 累计折旧 | 固定资产的折旧（抵减科目） | 借- 贷+ |
| 1601 | 长期投资 | 长期持有的股权、基金 | 借+ 贷- |

#### 二、负债类科目
| 科目代码 | 科目名称 | 子科目示例 | 借减贷增 |
|---------|---------|-----------|---------|
| 2001 | 信用卡 | 招行信用卡、花呗、白条 | 借- 贷+ |
| 2101 | 短期借款 | 朋友借款、消费贷 | 借- 贷+ |
| 2201 | 长期借款 | 房贷、车贷 | 借- 贷+ |
| 2301 | 应付款项 | 我欠别人的钱 | 借- 贷+ |

#### 三、净资产/权益类科目
| 科目代码 | 科目名称 | 说明 | 借减贷增 |
|---------|---------|------|---------|
| 3001 | 期初净资产 | 开始记账时的家庭净资产 | 借- 贷+ |
| 3002 | 本期损益 | 收入-费用，期末自动结转 | 借- 贷+ |

#### 四、收入类科目
| 科目代码 | 科目名称 | 子科目示例 | 借减贷增 |
|---------|---------|-----------|---------|
| 4001 | 工资薪金 | 主业工资、年终奖 | 借- 贷+ |
| 4002 | 兼职副业 | 副业收入、稿费 | 借- 贷+ |
| 4003 | 投资收益 | 股票盈利、基金分红、利息 | 借- 贷+ |
| 4004 | 经营收入 | 个体经营、开店收入 | 借- 贷+ |
| 4005 | 其他收入 | 中奖、退税、报销 | 借- 贷+ |
| 4100 | 待分类收入 | 对账调节产生的未分类收入（过渡科目） | 借- 贷+ |

#### 五、费用类科目
| 科目代码 | 科目名称 | 子科目示例 | 借增贷减 |
|---------|---------|-----------|---------|
| 5001 | 餐饮饮食 | 买菜、外卖、餐厅、零食 | 借+ 贷- |
| 5002 | 交通出行 | 公交、打车、加油、停车 | 借+ 贷- |
| 5003 | 居住物业 | 水电燃气、物业费、维修 | 借+ 贷- |
| 5004 | 日用百货 | 生活用品、清洁用品 | 借+ 贷- |
| 5005 | 服饰美容 | 衣服、鞋、化妆品、理发 | 借+ 贷- |
| 5006 | 医疗健康 | 挂号、药品、保健品、体检 | 借+ 贷- |
| 5007 | 教育学习 | 书籍、课程、培训 | 借+ 贷- |
| 5008 | 娱乐休闲 | 电影、游戏、旅行、健身 | 借+ 贷- |
| 5009 | 人情社交 | 礼金、请客、红包 | 借+ 贷- |
| 5010 | 育儿教育 | 奶粉、学费、玩具 | 借+ 贷- |
| 5011 | 通讯网络 | 手机话费、宽带 | 借+ 贷- |
| 5012 | 保险支出 | 社保、商业保险 | 借+ 贷- |
| 5013 | 利息支出 | 房贷利息、信用卡利息 | 借+ 贷- |
| 5014 | 折旧费用 | 固定资产折旧分摊 | 借+ 贷- |
| 5099 | 其他费用 | 未分类费用 | 借+ 贷- |
| 5100 | 待分类费用 | 对账调节产生的未分类费用（过渡科目） | 借+ 贷- |

### 2.2 外部账户同步与自动对账

#### 2.2.1 核心理念

用户不可能记住每一笔消费。系统通过**对接外部数据源**获取账户的真实余额和交易流水，然后与用户手工记录进行**自动对账**：

> **账本余额（手工记录）** vs **外部真实余额（银行/券商数据）**
>
> 差异 = 外部真实余额 - 账本余额
>
> → 系统自动生成**调节分录**来补齐差异

#### 2.2.2 对账流程

```
┌──────────────┐    定期同步     ┌──────────────┐
│  外部数据源    │ ──────────→  │  同步快照表    │
│ 银行/券商/...  │              │ 余额 + 流水   │
└──────────────┘               └──────┬───────┘
                                      │ 对比
                               ┌──────▼───────┐
                               │  账本科目余额  │
                               │（手工分录汇总） │
                               └──────┬───────┘
                                      │
                              差异 = 外部 - 账本
                                      │
                    ┌─────────────────┼─────────────────┐
                    │                 │                  │
               差异 = 0          差异 ≠ 0           有明细流水
               （已平衡）      （需要调节）        （可尝试匹配）
                    │                 │                  │
                    ✅            生成待确认           自动匹配
                                调节分录             已记录分录
                                    │                   │
                              用户确认/编辑         未匹配部分
                              分类后入账           → 调节分录
```

#### 2.2.3 对账场景示例

**场景：用户本月银行卡手工记了 100 元餐饮，但银行实际扣了 200 元**

1. 月初银行存款科目余额（账本）：10,000 元
2. 用户手工记了一笔：`借：餐饮 100 / 贷：银行存款 100` → 账本余额 = 9,900
3. 系统同步银行真实余额 = 9,800
4. 差异 = 9,800 - 9,900 = **-100 元**
5. 系统自动生成一笔**待确认调节分录**：
```
借：待分类费用    100
  贷：银行存款      100
```
6. 用户看到这笔调节后，可以：
   - **确认并分类**：把"待分类费用"改为具体费用科目（如交通出行）
   - **拆分**：把 100 元拆成两笔不同分类
   - **标记为资产购置**：改为 `借：固定资产/短期投资`
   - **忽略**：保持为"待分类费用"

**场景：股票账户市值变动**

1. 上次同步时，股票账户市值 50,000
2. 本次同步，股票账户市值 53,000
3. 差异 = +3,000
4. 系统自动生成：
```
借：短期投资（股票）  3,000
  贷：投资收益（浮动盈亏）  3,000
```
5. 用户确认即可

**场景：信用卡账单同步**

1. 账本中信用卡负债余额 = 3,000
2. 银行同步信用卡待还金额 = 5,500
3. 差异 = 5,500 - 3,000 = **+2,500 负债增加**
4. 系统生成：
```
借：待分类费用    2,500
  贷：信用卡        2,500
```
5. 用户分类确认

#### 2.2.4 支持的外部数据源

系统定义统一的 **DataSourceAdapter 接口**，所有外部数据源通过实现该接口接入，后续按需开发具体 Adapter。

**统一接口能力：**
- **获取余额快照**：返回当前余额/市值、货币单位、快照时间
- **获取交易流水**：返回指定时间范围内的交易列表，每笔包含外部交易ID（用于去重）、日期、金额（正=收入/负=支出）、交易摘要、对方名称
- **连接测试**：验证数据源连接是否可用

**计划实现的 Adapter（按优先级排列）：**

| 优先级 | Adapter | 说明 |
|-------|---------|------|
| P0 (MVP) | 手动输入 | 用户手动输入余额快照 |
| P0 (MVP) | CSV 账单导入 | 解析 CSV 账单文件（银行/支付宝/微信等） |
| P1 | 银行开放平台 | 对接 Open Banking API |
| P1 | 券商/基金 | 对接券商持仓 API |
| P2 | 加密货币交易所 | 对接交易所 API（Binance 等） |
| P2 | 信用卡账单 | 对接信用卡 API |

> **MVP 阶段**仅实现 `ManualInputAdapter` 和 `CsvImportAdapter`，其余 Adapter 后续按需开发，接入时无需修改核心对账逻辑。

#### 2.2.5 科目绑定外部数据源

每个资产/负债类科目可以关联一个外部数据源：

- 科目"招商银行储蓄卡" → 绑定招行 Open Banking 接口
- 科目"中信证券" → 绑定券商持仓接口
- 科目"招行信用卡" → 绑定信用卡账单接口

未绑定数据源的科目 = 纯手工记账科目（如现金）。

#### 2.2.6 调节分录的分类规则

系统对调节分录的默认分类策略：

| 科目类型 | 差异方向 | 默认调节分录 | 用户操作 |
|---------|---------|-------------|---------|
| 银行存款 | 余额减少 | 借：待分类费用 / 贷：银行存款 | 用户确认具体费用分类 |
| 银行存款 | 余额增加 | 借：银行存款 / 贷：待分类收入 | 用户确认具体收入来源 |
| 信用卡 | 负债增加 | 借：待分类费用 / 贷：信用卡 | 用户确认费用分类 |
| 信用卡 | 负债减少 | 借：信用卡 / 贷：待确认来源 | 通常为还款，用户确认支付账户 |
| 股票/基金 | 市值增加 | 借：投资账户 / 贷：投资收益（浮动） | 自动，无需确认 |
| 股票/基金 | 市值减少 | 借：投资损失（浮动）/ 贷：投资账户 | 自动，无需确认 |

> **新增科目**：`5100 待分类费用`、`4100 待分类收入` — 用作调节分录的临时过渡科目。用户可随时对其进行分类归档。

#### 2.2.7 流水明细匹配（进阶）

当外部数据源提供**交易流水明细**（而非仅余额）时，系统可以进行智能匹配：

1. **金额 + 日期匹配**：外部流水中的一笔 -200 元（2月10日）与手工分录 200 元费用（2月10日）自动匹配
2. **已匹配 → 标记已对账**，不生成调节分录
3. **未匹配的外部流水 → 生成待确认分录**，预填金额和日期，用户只需选分类
4. **未匹配的手工分录 → 标记为"未在外部账户体现"**，提醒用户核实

### 2.3 典型记账场景（复式分录）

以下是用户常见操作对应的会计分录：

#### 场景1：发工资 15000 元到银行卡
```
借：银行存款    15,000
  贷：工资薪金    15,000
```
效果：资产↑，收入↑，净资产↑

#### 场景2：超市买菜花 200 元（微信支付）
```
借：餐饮饮食    200
  贷：第三方支付（微信）  200
```
效果：资产↓，费用↑，净资产↓

#### 场景3：花 8000 元买一部手机（银行卡）
```
借：固定资产（手机）  8,000
  贷：银行存款        8,000
```
效果：资产内部转换，总资产不变，净资产不变

#### 场景4：贷款买房，首付 60 万，贷款 200 万
```
借：固定资产（房产）  2,600,000
  贷：银行存款          600,000
  贷：长期借款（房贷）  2,000,000
```
效果：资产↑260万，负债↑200万，资产（现金）↓60万

#### 场景5：还房贷（本金 5000 + 利息 3000）
```
借：长期借款（房贷）  5,000
借：利息支出        3,000
  贷：银行存款        8,000
```
效果：负债↓5000，费用↑3000，资产↓8000

#### 场景6：信用卡消费 500 元吃饭
```
借：餐饮饮食    500
  贷：信用卡      500
```
效果：负债↑，费用↑，净资产↓

#### 场景7：还信用卡 5000 元
```
借：信用卡      5,000
  贷：银行存款    5,000
```
效果：负债↓，资产↓，净资产不变

#### 场景8：股票账户充值 50000 元
```
借：短期投资（股票账户）  50,000
  贷：银行存款            50,000
```
效果：资产内部转换

#### 场景9：股票盈利 3000 元（卖出时）
```
借：银行存款    53,000
  贷：短期投资（股票）  50,000
  贷：投资收益          3,000
```
效果：资产不变，收入↑，净资产↑

### 2.4 用户视角简化

虽然底层是复式记账，但**用户界面应极度简化**：

用户不需要理解"借/贷"概念，系统根据操作类型自动生成分录：

| 用户操作 | 用户填写的信息 | 系统自动生成 |
|---------|--------------|-------------|
| 记一笔费用 | 金额 + 费用分类 + 支付方式 | 借：费用科目 / 贷：资产/负债科目 |
| 记一笔收入 | 金额 + 收入分类 + 收款账户 | 借：资产科目 / 贷：收入科目 |
| 购买资产 | 金额 + 资产名称 + 支付方式 | 借：资产科目 / 贷：资产/负债科目 |
| 借入/贷款 | 金额 + 贷款名称 + 收款账户 | 借：资产科目 / 贷：负债科目 |
| 还款 | 金额 + 本金/利息拆分 + 支付账户 | 借：负债+费用 / 贷：资产科目 |
| 账户互转 | 金额 + 从哪 + 到哪 | 借：目标资产 / 贷：来源资产 |

---

## 3. 功能需求

### 3.1 用户系统

#### 3.1.1 注册/登录
- 邮箱 + 密码注册/登录
- 手机号 + 验证码登录
- 第三方登录（微信、Google）
- 记住登录状态

#### 3.1.2 个人信息
- 头像、昵称设置
- 默认货币单位设置（CNY/USD 等）
- 通知偏好设置

### 3.2 账本管理

#### 3.2.1 账本
- 创建账本（个人 / 家庭）
- 家庭账本邀请成员（链接或手机号）
- 成员角色：管理员 / 成员
- 多账本切换

#### 3.2.2 初始化向导
首次创建账本时，引导用户录入**期初资产负债**：
1. 添加现金/银行存款/第三方支付余额
2. 添加投资账户（股票、基金等市值）
3. 添加大额资产（房产、汽车等估值）
4. 添加负债（房贷余额、信用卡待还等）
5. 系统自动计算期初净资产

### 3.3 外部账户同步

#### 3.3.1 绑定外部数据源
- 在科目管理中，为资产/负债科目绑定外部数据源
- 支持的绑定方式：
  - **手动输入余额**：用户定期手动填入真实余额（MVP 优先）
  - **CSV/账单导入**：导入银行、支付宝、微信的账单文件
  - **API 对接**：（后续版本）银行 Open Banking、券商 API、交易所 API
- 绑定后，科目卡片展示两个数字：**账本余额** / **外部余额**

#### 3.3.2 同步余额快照
- 用户手动录入：进入某个科目 → "更新真实余额" → 输入当前真实金额
- CSV 导入：上传账单 → 系统解析流水 → 计算期末余额
- API 同步：后台定时拉取 → 自动更新快照

#### 3.3.3 自动对账与调节
- 同步后系统自动计算差异 = 外部余额 - 账本余额
- **差异 = 0**：显示 ✅ 已平衡
- **差异 ≠ 0**：自动生成**待确认调节分录**，进入"待处理"队列
- 调节分录默认使用"待分类费用"或"待分类收入"作为对方科目
- 投资类科目的市值变动自动归入"投资收益/损失"

#### 3.3.4 待处理队列
- 所有自动生成的调节分录进入"待处理"列表
- 每条待处理项展示：日期、科目、差异金额、建议分类
- 用户操作：
  - **确认并分类**：选择具体的费用/收入科目
  - **拆分**：将一笔差异拆成多笔不同分类
  - **标记为资产变动**：如差异实为购买资产
  - **忽略（标记已读）**：保持为待分类
- 首页展示待处理数量角标，提醒用户及时分类

#### 3.3.5 对账历史
- 记录每次对账的时间、科目、差异金额、处理状态
- 支持查看某科目的对账历史走势

### 3.4 记账功能（核心）

#### 3.4.1 快捷记账入口（6种操作类型）

**① 记费用（Expense）**
- 金额输入
- 费用分类选择（餐饮/交通/居住...）
- 支付方式（从哪个资产或负债科目出）
- 日期、备注、图片（可选）
- → 系统自动：借费用科目，贷资产/负债科目

**② 记收入（Income）**
- 金额输入
- 收入分类选择（工资/理财收益/副业...）
- 收入账户（钱进到哪个资产科目）
- 日期、备注
- → 系统自动：借资产科目，贷收入科目

**③ 购买资产（Buy Asset）**
- 金额输入
- 资产类型 + 名称（如：固定资产-iPhone 16）
- 支付方式（现金/银行卡/信用卡/贷款组合）
- 是否设置折旧（固定资产可选）
- → 系统自动：借资产科目，贷资产/负债科目

**④ 借入/贷款（Borrow）**
- 金额输入
- 负债类型 + 名称（如：长期借款-房贷）
- 收款账户
- 贷款信息（可选）：期限、利率、还款方式
- → 系统自动：借资产科目，贷负债科目

**⑤ 还款（Repay）**
- 选择要还的负债
- 本期还款金额
- 本金/利息拆分（系统可根据贷款信息自动计算）
- 支付账户
- → 系统自动：借负债+利息费用，贷资产科目

**⑥ 账户互转（Transfer）**
- 金额
- 从哪个账户 → 到哪个账户
- → 系统自动：借目标，贷来源

#### 3.4.2 高级模式：手动分录
为进阶用户提供手动输入借贷分录的能力：
- 自由选择借方科目和贷方科目
- 支持一借多贷、多借一贷、多借多贷
- 系统校验借贷必须平衡

#### 3.4.3 固定资产折旧
- 对固定资产设置折旧方式：
  - 直线法（每月平均折旧）
  - 自定义残值率
  - 折旧年限
- 系统每月自动生成折旧分录：`借：折旧费用 / 贷：累计折旧`
- 资产列表中展示：原值、累计折旧、净值

#### 3.4.4 记录管理
- 按时间线查看分录列表
- 编辑/删除分录
- 搜索（按科目、金额、备注、日期筛选）
- 每笔分录展示借贷科目和对净资产的影响

### 3.5 资产负债表（核心报表）

#### 3.5.1 资产负债表页面
实时生成资产负债表，展示当前家庭财务全貌：

```
┌─────────────────────────────────────────┐
│         家庭资产负债表                     │
│         2026年2月12日                     │
├────────────────────┬────────────────────┤
│      资 产         │     负债 + 净资产    │
├────────────────────┤────────────────────┤
│ 流动资产           │ 流动负债             │
│   现金      5,000  │   信用卡    3,000   │
│   银行存款 80,000  │   花呗      1,500   │
│   支付宝  12,000   │   短期借款      0   │
│   微信     3,000   │   ──────────────    │
│   ──────────────   │   小计      4,500   │
│   小计    100,000  │                     │
│                    │ 长期负债             │
│ 投资资产           │   房贷   1,800,000  │
│   股票    50,000   │   车贷     80,000   │
│   基金    30,000   │   ──────────────    │
│   理财    20,000   │   小计  1,880,000   │
│   ──────────────   │                     │
│   小计    100,000  │ ━━━━━━━━━━━━━━━━━   │
│                    │ 负债合计 1,884,500   │
│ 固定资产           │                     │
│   房产  2,500,000  │ ━━━━━━━━━━━━━━━━━   │
│   汽车    120,000  │ 净资产               │
│   电脑      6,000  │   期初净资产 800,000 │
│   累计折旧 -26,000 │   本期损益   15,500  │
│   ──────────────   │   ──────────────    │
│   小计  2,600,000  │   小计    815,500   │
│                    │                     │
├────────────────────┼────────────────────┤
│ 资产总计 2,800,000 │ 负债+净资产 2,800,000│
│         ✅ 平衡     │                    │
└────────────────────┴────────────────────┘
```

#### 3.5.2 资产负债表功能
- 支持选择查看日期（任意历史时点）
- 点击科目可展开查看明细
- 资产/负债变化趋势对比
- 净资产变化走势图

### 3.6 损益表（利润表）

展示一段时间内的收入和费用：

```
┌─────────────────────────────┐
│     家庭损益表               │
│     2026年2月                │
├─────────────────────────────┤
│ 收入                        │
│   工资薪金       15,000     │
│   投资收益        2,000     │
│   其他收入          500     │
│   ─────────────────────     │
│   收入合计       17,500     │
│                             │
│ 费用                        │
│   餐饮饮食        3,000     │
│   交通出行          800     │
│   居住物业        2,500     │
│   日用百货          500     │
│   娱乐休闲        1,200     │
│   利息支出        3,000     │
│   折旧费用        1,000     │
│   ─────────────────────     │
│   费用合计       12,000     │
│                             │
├─────────────────────────────┤
│ 本期损益（净利润） +5,500   │
└─────────────────────────────┘
```

### 3.7 统计与分析

#### 3.7.1 概览仪表盘
- **净资产**大数字展示 + 较上月变化
- 本月收入/费用/损益卡片
- 资产构成饼图（现金类/投资类/固定资产）
- 负债构成饼图

#### 3.7.2 趋势分析
- **净资产趋势折线图**（月度/年度）
- **收入 vs 费用**月度对比柱状图
- **费用分类趋势**（各分类费用的月度变化）
- **资产负债比率**趋势

#### 3.7.3 资产分析
- 资产配置分析（流动资产/投资/固定资产占比）
- 投资收益率
- 负债率 = 总负债 / 总资产
- 流动比率 = 流动资产 / 流动负债

#### 3.7.4 费用分析
- 费用分类饼图
- 费用排行榜
- 环比分析（对比上月）

### 3.8 预算管理

#### 3.8.1 预算设置
- 月度总费用预算
- 分类费用预算（如：餐饮 3000/月）
- 注意：**预算只针对"费用类"科目**，购买资产不算在费用预算内

#### 3.8.2 预算提醒
- 达到 80% 时提醒
- 超支提醒
- 自定义阈值

### 3.9 数据管理

#### 3.9.1 数据导出
- 导出资产负债表（Excel/PDF）
- 导出损益表（Excel/PDF）
- 导出分录明细（CSV）
- 自定义时间范围

#### 3.9.2 数据导入
- CSV 格式导入历史分录
- 导入模板下载

---

## 4. 页面结构

### 4.1 页面导航（底部 Tab）

```
┌─────────────────────────────┐
│                             │
│        [页面内容区]          │
│                             │
├──────┬──────┬──────┬────────┤
│ 总览 │ 账本 │ 报表 │  我的  │
│  🏠  │  📖  │  📊  │  👤   │
└──────┴──────┴──────┴────────┘
         [+] 记账按钮（浮动）
```

### 4.2 各页面说明

#### 页面1：总览（Dashboard）
- **净资产**大字展示 + 涨跌标识
- 迷你资产负债表（资产总计 / 负债总计 / 净资产）
- 本月损益卡片（收入/费用/结余）
- **待处理角标**：显示未分类的调节分录数量，点击进入待处理队列
- 费用预算进度条
- 近期分录列表（最近 5 条）
- 净资产月度趋势迷你图

#### 页面2：账本（Ledger）
- 顶部切换：全部 / 费用 / 收入 / 资产变动 / 负债变动
- 按日期分组的分录列表
- 每条分录显示：
  - 图标 + 摘要（如"餐饮 - 微信支付"）
  - 金额（正/负色彩区分）
  - 对净资产的影响标识：净资产+/-/不变
- 顶部筛选（时间范围、科目类型）
- 搜索

#### 页面3：报表（Reports）
- Tab 切换：资产负债表 / 损益表 / 趋势分析
- **资产负债表**：左右或上下布局，展示完整报表
- **损益表**：收入费用汇总
- **趋势分析**：
  - 净资产走势
  - 收入 vs 费用
  - 资产配置
  - 关键财务指标

#### 页面4：我的（Profile）
- 个人信息
- 账本管理
- 科目管理（自定义科目）
- **外部账户管理**（绑定/解绑数据源、同步设置、对账历史）
- 固定资产管理（查看资产列表、折旧状态）
- 贷款管理（查看负债详情、还款计划）
- 预算设置
- 数据导入/导出
- 设置（货币、深色模式、通知）
- 关于 & 反馈

#### 弹窗/页面：记账
- 顶部 Tab：费用 | 收入 | 购买资产 | 借入/贷款 | 还款 | 转账
- 根据选中类型显示对应表单
- 金额输入（大数字键盘）
- 科目/分类选择
- 日期选择
- 备注
- 保存

### 4.3 桌面 Web 端适配规范

移动端和桌面端共享同一套代码（Expo），通过**响应式布局**在不同屏幕尺寸下呈现最佳体验。

#### 4.3.1 响应式断点

| 断点名称 | 宽度范围 | 典型设备 | 导航方式 |
|---------|---------|---------|---------|
| `xs` | < 640px | 手机竖屏 | 底部 Tab |
| `sm` | 640px - 1023px | 平板/手机横屏 | 底部 Tab |
| `md` | 1024px - 1439px | 小屏笔记本 | 左侧边栏（收起） |
| `lg` | ≥ 1440px | 桌面显示器 | 左侧边栏（展开） |

#### 4.3.2 导航布局

**移动端（< 1024px）：**
```
┌─────────────────────────────┐
│                             │
│        [页面内容区]          │
│                             │
├──────┬──────┬──────┬────────┤
│ 总览 │ 账本 │ 报表 │  我的  │
│  🏠  │  📖  │  📊  │  👤   │
└──────┴──────┴──────┴────────┘
         [+] 记账浮动按钮
```

**桌面端（≥ 1024px）：**
```
┌──────┬────────────────────────────────────┐
│      │  面包屑/标题栏          [+ 记账]   │
│ 🏠   ├──────────────────────────────────── │
│ 总览 │                                    │
│      │                                    │
│ 📖   │          页面内容区                 │
│ 账本 │       （最大宽度 1200px）           │
│      │                                    │
│ 📊   │                                    │
│ 报表 │                                    │
│      │                                    │
│ 👤   │                                    │
│ 我的 │                                    │
│      │                                    │
│──────│                                    │
│ 设置 │                                    │
└──────┴────────────────────────────────────┘
```

- **≥ 1440px**：侧边栏默认展开（图标 + 文字，宽度 220px）
- **1024px - 1439px**：侧边栏默认收起（仅图标，宽度 64px），hover 展开
- **记账按钮**：从浮动按钮变为顶部栏右侧固定按钮

#### 4.3.3 各页面桌面端布局

**总览（Dashboard）— 网格布局：**
```
┌─────────────────────────────────────────────────┐
│  净资产 ¥815,500  ↑2.3%                         │
├───────────────┬───────────────┬─────────────────┤
│  本月收入      │  本月费用      │  本月结余        │
│  ¥17,500      │  ¥12,000      │  +¥5,500       │
├───────────────┴───────────────┼─────────────────┤
│                               │                 │
│  净资产趋势图（折线图）         │  资产构成饼图     │
│  （占 2/3 宽度）              │  （占 1/3 宽度）  │
│                               │                 │
├───────────────────────────────┼─────────────────┤
│                               │ 待处理 (3)      │
│  近期分录（最近 10 条）        │ · 银行差异 -100  │
│  （表格形式，含借贷科目列）     │ · 信用卡 +2500  │
│                               │ · 股票盈亏 +3000│
│                               │ 费用预算进度     │
│                               │ ████░░ 68%     │
└───────────────────────────────┴─────────────────┘
```

**账本（Ledger）— 主从布局：**
```
┌────────────────────────┬────────────────────────┐
│ 筛选栏                  │ 分录详情               │
│ [全部|费用|收入|资产|负债]│                       │
│ 日期范围 | 搜索框        │ 选中分录的完整信息      │
├────────────────────────┤ · 借贷科目明细          │
│ 2月12日                 │ · 金额                 │
│ 🍜 午餐-微信    -45.00 │ · 对净资产影响          │
│ 🚕 打车-支付宝  -28.00 │ · 备注/附件            │
│ 2月11日                 │                       │
│ 💰 工资-银行  +15000   │ [编辑] [删除]          │
│ 🛒 超市-微信   -186.50 │                       │
│ ...                    │                       │
└────────────────────────┴────────────────────────┘
```

**报表（Reports）— 宽屏优化：**

资产负债表采用**左右对照式**：
```
┌───────────────────────┬───────────────────────┐
│       资 产            │     负债 + 净资产      │
├───────────────────────┼───────────────────────┤
│ 流动资产               │ 流动负债               │
│   现金         5,000  │   信用卡       3,000  │
│   银行存款    80,000  │   花呗         1,500  │
│   支付宝      12,000  │   小计         4,500  │
│   微信         3,000  │                       │
│   小计       100,000  │ 长期负债               │
│                       │   房贷     1,800,000  │
│ 投资资产               │   车贷        80,000  │
│   股票        50,000  │   小计     1,880,000  │
│   基金        30,000  │                       │
│   小计       100,000  │ 负债合计   1,884,500  │
│                       │ ──────────────────── │
│ 固定资产               │ 净资产                 │
│   房产     2,500,000  │   期初净资产  800,000  │
│   汽车       120,000  │   本期损益    15,500  │
│   累计折旧   -26,000  │   小计       815,500  │
│   小计     2,600,000  │                       │
├───────────────────────┼───────────────────────┤
│ 资产总计   2,800,000  │ 负债+净资产 2,800,000 │
│            ✅ 平衡     │                      │
└───────────────────────┴───────────────────────┘
```

损益表在桌面端右侧可并排展示费用分类饼图。

趋势分析采用**双列图表网格**，图表尺寸更大，交互更丰富（hover 提示、可缩放时间轴）。

**我的（Profile）— 分栏布局：**
```
┌──────────────────┬──────────────────────────────┐
│ 个人信息卡片      │ 设置详情区                     │
│  头像 + 昵称     │                              │
│                  │ 根据左侧选中菜单显示对应内容     │
│ ─────────────    │                              │
│ 📚 账本管理      │ 例如选中"科目管理"时：          │
│ 📂 科目管理      │ 以树形表格展示完整科目体系       │
│ 🔗 外部账户      │ 支持搜索/展开/折叠/编辑        │
│ 🏠 固定资产      │                              │
│ 💳 贷款管理      │                              │
│ 💰 预算设置      │                              │
│ 📤 数据导入/导出  │                              │
│ ⚙️ 设置         │                              │
│ ℹ️ 关于         │                              │
└──────────────────┴──────────────────────────────┘
```

**记账弹窗 — 居中 Modal：**
```
         ┌────────────────────────────────┐
         │  ✕   新建记账                   │
         ├────────────────────────────────┤
         │ [费用|收入|购买资产|借入|还款|转账]│
         │                                │
         │  金额：  ¥ [          ]        │
         │  分类：  [餐饮饮食      ▼]      │
         │  账户：  [微信钱包      ▼]      │
         │  日期：  [2026-02-12   📅]     │
         │  备注：  [                ]     │
         │                                │
         │         [取消]  [保存]          │
         └────────────────────────────────┘
```
- 最大宽度 560px，居中显示
- 背景半透明遮罩，点击遮罩或按 Esc 关闭
- 移动端仍为全屏页面

#### 4.3.4 桌面端交互增强

| 特性 | 移动端 | 桌面端 |
|-----|-------|-------|
| **键盘快捷键** | — | `N` 新建记账、`/` 聚焦搜索、`Esc` 关闭弹窗 |
| **表格操作** | 滑动删除 | 右键菜单（编辑/删除/复制） |
| **图表交互** | 点击查看详情 | hover 提示 + 点击钻取 |
| **拖拽** | — | 支持拖拽排序科目 |
| **批量操作** | — | 多选分录批量删除/分类 |
| **数据密度** | 卡片式、大字体 | 表格式、更紧凑、每页显示更多条目 |

#### 4.3.5 内容宽度约束

- 页面内容区最大宽度 **1200px**，水平居中
- 报表/表格区域可突破至 **1400px**（利用更多水平空间）
- 侧边栏 + 内容区总宽度不设上限，侧边栏固定宽度，内容区自适应

---

## 5. 非功能需求

### 5.1 性能要求
- 页面首屏加载 < 2秒
- 记账操作响应 < 500ms
- 资产负债表实时计算 < 1秒

### 5.2 兼容性
- Web 端：Chrome、Safari、Firefox、Edge 最新两个版本
- Web 桌面端：最小支持宽度 360px（手机浏览器），最佳体验 ≥ 1024px
- Android：Android 10+（原生应用）
- iOS：iOS 14+（原生应用）
- 三端共享代码，通过响应式断点（详见 4.3.1）在不同屏幕尺寸下自适应布局

### 5.3 安全性
- 用户数据加密存储
- HTTPS 传输
- 敏感操作需二次验证
- 数据隔离，不同家庭数据不可互访

### 5.4 国际化
- 初期支持中文简体
- 架构预留多语言支持

---

## 6. 技术方案、数据模型与设计规范

> 详见 [TECH_SPEC.md](./TECH_SPEC.md)

---

## 7. 版本规划

### v1.0 MVP（最小可行产品）
- [x] 邮箱注册/登录
- [x] 科目体系（预置五大类科目）
- [x] 快捷记账（费用/收入/转账/购买资产）
- [x] 分录列表（账本明细）
- [x] 资产负债表
- [x] 损益表
- [x] 总览仪表盘（净资产、本月损益）
- [x] 基础统计图表（净资产趋势、费用饼图）
- [x] **手动余额快照 & 自动对账调节**（待分类费用/收入）
- [x] **待处理队列**（调节分录分类确认）
- [x] 三端适配（Android + iOS + Web，Expo 统一输出）
- [x] 深色模式

### v1.5
- [ ] 家庭账本 & 多人协作
- [ ] **CSV 账单导入 & 流水匹配对账**
- [ ] 固定资产折旧管理
- [ ] 贷款管理 & 还款计划
- [ ] 预算管理 & 提醒
- [ ] 高级模式（手动分录）
- [ ] 数据导出（CSV/Excel/PDF）

### v2.0
- [ ] **银行 Open Banking API 对接**
- [ ] **券商/基金 API 对接（持仓市值自动同步）**
- [ ] **智能流水分类（基于历史记录的 AI 建议）**
- [ ] 期初向导（引导录入家庭资产负债）
- [ ] 月度/年度财务报告自动生成
- [ ] 财务健康评分
- [ ] 第三方登录
- [ ] 离线记账 + 本地 SQLite 缓存
