# 家庭记账 - 产品需求文档 (PRD)

> **版本：v0.0.3**
> **创建日期：2026-02-13**
> **基于版本：v0.0.2**
> **状态：规划中**
> **本版本变更：总览页桌面端布局重构（左右分栏）**

---

## 1. 版本概述

### 1.1 版本目标

v0.0.3 对总览（Dashboard）页面的桌面端布局进行重构，将原有的**网格堆叠式布局**改为类似账本（Ledger）的**左右分栏（Master-Detail）布局**，提升桌面端的信息密度和操作效率。

| 变更 | 核心价值 |
|------|---------|
| 总览页桌面端左右分栏 | 左侧展示财务概览（净资产、收入费用、图表、预算、贷款），右侧展示近期分录列表，一屏可同时浏览概览与明细，无需上下滚动 |
| 移动端移除近期分录 | 减少 Dashboard 滚动深度，避免与账本 Tab 内容重复，用户可直接切换到账本 Tab 查看分录 |

### 1.2 与 v0.0.2 的关系

- **纯前端改动**：仅涉及 `app/(tabs)/index.tsx` 的桌面端布局重构，后端无变更
- **移动端变更**：移动端不再显示近期分录区块（近期分录仅在桌面端右侧面板展示，移动端用户可通过账本 Tab 查看）
- **数据接口不变**：复用 v0.0.2 已有的 Dashboard API、趋势 API、费用分析 API

### 1.3 不包含的内容（留待后续版本）

- 家庭账本 & 多人协作
- CSV 账单导入 & 流水匹配对账
- 高级模式（手动分录）
- 数据导出（CSV/Excel/PDF）

---

## 2. 功能需求：总览页桌面端布局重构

### 2.1 当前布局问题

v0.0.1/v0.0.2 的桌面端 Dashboard 采用网格堆叠式布局：

```
┌─────────────────────────────────────────────────┐
│  净资产 ¥815,500  ↑2.3%                         │
├───────────────┬───────────────┬─────────────────┤
│  本月收入      │  本月费用      │  本月结余        │
│  ¥17,500      │  ¥12,000      │  +¥5,500       │
├───────────────┴───────────────┼─────────────────┤
│                               │                 │
│  净资产趋势图（折线图）         │  资产构成饼图     │
│                               │                 │
├───────────────────────────────┼─────────────────┤
│                               │ 待处理 (3)      │
│  （空白）                     │ 费用预算进度      │
│                               │ 贷款概览         │
├───────────────────────────────┴─────────────────┤
│  近期分录（在底部，需要下滚才能看到）              │
└─────────────────────────────────────────────────┘
```

**问题：**
1. 近期分录在页面最底部，需要滚动才能看到，桌面端大屏空间利用率低
2. 与账本（Ledger）页面的左右分栏交互模式不统一
3. 右列内容过少（饼图+待处理+预算+贷款），左列过重
4. 整体布局偏「移动端放大版」，未充分发挥桌面端宽屏优势

### 2.2 新布局设计

采用与账本（Ledger）一致的**左右分栏布局**：

- **左侧面板**（可滚动）：财务概览信息（净资产、收入费用、图表、预算、贷款、待处理等）
- **右侧面板**（独立滚动）：近期分录列表，点击可跳转到分录详情

```
┌──────────────────────────────────┬──────────────────────────────┐
│  💰 财务概览                      │  📋 近期分录                  │
│                                  │                              │
│  净资产 ¥815,500  ↑2.3%          │  查看全部 →                   │
│  ┌──────────┬──────────┐         │                              │
│  │ 本月收入  │ 本月费用  │         │  2月13日                     │
│  │ ¥17,500  │ ¥12,000  │         │  🍜 午餐 - 微信      -45.00  │
│  └──────────┴──────────┘         │  🚕 打车 - 支付宝    -28.00  │
│  本月结余  +¥5,500               │                              │
│                                  │  2月12日                     │
│  ┌─────────────────────────────┐ │  💰 工资 - 银行   +15000.00  │
│  │  净资产趋势图（折线图）       │ │  🛒 超市 - 微信     -186.50  │
│  │                             │ │  ⛽ 加油 - 银行     -320.00  │
│  └─────────────────────────────┘ │                              │
│  ┌─────────────────────────────┐ │  2月11日                     │
│  │  本月费用分类（饼图）         │ │  🎮 游戏 - 微信      -68.00  │
│  │                             │ │  📱 话费 - 支付宝    -99.00  │
│  └─────────────────────────────┘ │                              │
│                                  │  2月10日                     │
│  ┌──────────────┐                │  🏠 房贷还款        -10614.00│
│  │ 待处理 (3)  → │                │  💳 信用卡还款       -5000.00│
│  └──────────────┘                │                              │
│  ┌──────────────┐                │  ...                         │
│  │ 费用预算 68% │                │                              │
│  │ ████████░░░░ │                │                              │
│  └──────────────┘                │                              │
│  ┌──────────────┐                │                              │
│  │ 贷款概览     │                │                              │
│  │ 剩余 ¥196万  │                │                              │
│  └──────────────┘                │                              │
└──────────────────────────────────┴──────────────────────────────┘
```

### 2.3 布局规格

| 属性 | 说明 |
|------|------|
| 生效条件 | 桌面端（屏幕宽度 ≥ 768px） |
| 整体布局 | `flexDirection: 'row'`，全高 |
| 左侧面板 | 固定宽度 **380px**（与「我的」页面左侧菜单宽度一致），内部 `ScrollView` 纵向滚动 |
| 右侧面板 | `flex: 1`，展示近期分录 |
| 分割线 | 左侧面板右边缘 `borderRightWidth: 1`，颜色取 `colors.border` |
| 左侧间距 | `padding: 16` |
| 右侧间距 | header `paddingHorizontal: 16`，列表 `paddingHorizontal: 16` |

### 2.4 左侧面板内容（概览区）

左侧面板按照从上到下的顺序排列：

1. **净资产徽章**（`NetWorthBadge`）
2. **本月收入 / 本月费用**（横排两列卡片）
3. **本月结余卡片**
4. **净资产趋势折线图**（`LineChart`）— 图表宽度固定适配 380px 面板（380 - padding）
5. **本月费用分类饼图**（`PieChart`）
6. **待处理对账**（`pendingSection`，有数据时才显示）
7. **费用预算进度**（`BudgetOverview`）
8. **贷款概览**（`LoanOverview`）

> 注意：折线图的 `width` prop 改为基于左侧面板固定宽度 380px 计算（380 - padding*2），不再使用 `screenWidth`。

### 2.5 右侧面板内容（分录区）

右侧面板展示近期分录列表：

1. **头部**：标题 "近期分录" + "查看全部" 链接（点击跳转到账本 tab）
2. **分录列表**：
   - 复用 Dashboard 已有的 `recent_entries` 数据（来自 `reportService.getDashboard`）
   - 按日期分组展示（与账本页面一致）
   - 每条分录显示：类型标签、描述/日期、金额
   - 点击分录跳转到 `/entry/${id}` 详情页
3. **空状态**：无分录时显示引导文案 "暂无记录，点击 + 开始记账"
4. **浮动记账按钮（FAB）**：右下角固定 `+` 按钮，点击跳转到 `/entry/new`

### 2.6 移动端布局（移除近期分录）

移动端（屏幕宽度 < 768px）保持单列堆叠式布局，但**不再显示近期分录区块**（用户可通过底部账本 Tab 查看分录）：

```
┌─────────────────────────────┐
│  净资产 ¥815,500  ↑2.3%     │
│  ┌──────────┬──────────┐    │
│  │ 本月收入  │ 本月费用  │    │
│  └──────────┴──────────┘    │
│  本月结余  +¥5,500          │
│  净资产趋势图               │
│  费用分类饼图               │
│  待处理对账                 │
│  费用预算                   │
│  贷款概览                   │
│  （无近期分录，去账本查看）   │
└─────────────────────────────┘
```

> **设计理由**：移动端屏幕空间有限，近期分录与账本（Ledger）Tab 内容高度重复，移除后可减少 Dashboard 滚动深度，用户需查看分录时直接切换到账本 Tab 即可。

### 2.7 交互细节

| 交互 | 说明 |
|------|------|
| 左右独立滚动 | 左侧概览区和右侧分录区各自独立滚动，互不影响 |
| 下拉刷新 | 左侧面板支持下拉刷新，刷新时同时更新左侧概览数据和右侧分录数据 |
| 分录点击 | 点击右侧分录跳转到 `/entry/${id}` 详情页（不在右侧展开，因为 Dashboard 的主功能是概览） |
| 查看全部 | 点击 "查看全部" 跳转到账本（Ledger）tab |
| 记账按钮 | 右侧面板右下角浮动 `+` 按钮 |
| 图表宽度 | 折线图宽度基于左侧面板固定 380px 计算 |

### 2.8 深色模式

所有新增/修改的样式均需适配深色模式：
- 分割线颜色使用 `colors.border`
- 右侧面板背景使用 `colors.background`
- 其他颜色通过 `Colors[colorScheme]` 动态取色

---

## 3. 版本规划更新

### v0.0.1 (MVP) — 已完成 ✅
- [x] 邮箱注册/登录
- [x] 科目体系
- [x] 快捷记账（6种类型）
- [x] 分录列表（账本）
- [x] 资产负债表 & 损益表
- [x] 总览仪表盘
- [x] 手动对账 & 待处理队列
- [x] 三端适配 & 深色模式

### v0.0.2 — 已完成 ✅
- [x] 固定资产折旧管理（自动折旧分录、资产处置）
- [x] 贷款管理 & 还款计划（还款计划表、本金/利息自动拆分、提前还款）
- [x] 预算管理 & 提醒（总预算/分类预算、超支提醒、Dashboard 联动）

### v0.0.3 — 本版本 — 已完成 ✅
- [x] 总览页桌面端布局重构（左右分栏，近期分录移至右侧面板）
- [x] 移动端 Dashboard 移除近期分录区块

### v0.0.4（规划中）
- [ ] 家庭账本 & 多人协作
- [ ] CSV 账单导入 & 流水匹配对账
- [ ] 高级模式（手动分录）
- [ ] 数据导出（CSV/Excel/PDF）

### v0.1.0（远期）
- [ ] 银行 Open Banking API 对接
- [ ] 券商/基金 API 对接
- [ ] 智能流水分类（AI 建议）
- [ ] 离线记账 + 本地 SQLite 缓存
